# ┌─────────────────┐
# │░▀█▀░█▄█░█░█░█░█░│
# │░░█░░█░█░█░█░▄▀▄░│
# │░░▀░░▀░▀░▀▀▀░▀░▀░│
# └─────────────────┘
# Roosta <mail@roosta.sh>
# https://roosta.sh
# https://github.com/roosta/dotfiles
# Options {{{
#------------

# shell
set -g default-shell   "${SHELL}"
set -g default-command "${SHELL}"

# source config file
bind R source-file ~/.tmux.conf \; display-message "Config reloading..."

# set  -g default-terminal "screen-256color"

# https://wiki.archlinux.org/index.php/Tmux#24-bit_color
set -ga terminal-overrides ",xterm-termite:Tc"

set -g default-terminal "tmux-256color"
setw -g xterm-keys on
set  -g set-titles on
set  -g set-titles-string "#T" # T will display user@host:~ and change accordingly as you connect to different hosts.
setw -g pane-base-index 1
# setw -g monitor-activity off
# setw -g monitor-silence off #30
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
set -g mode-keys vi
set -g status-keys vi
set -g wrap-search on
set -g bell-on-alert on
set -g bell-action any
set -g display-time 4000

# https://github.com/tmux-plugins/vim-tmux-focus-events
set -g focus-events on

# send notification on bell
set-hook -g alert-bell 'run ". ~/utils/tmux-notify.sh; return 0"'

# Rather than constraining window size to the maximum size of any client
# connected to the *session*, constrain window size to the maximum size of any
# client connected to *that window*. Much more reasonable.
setw -g aggressive-resize on

# fix escape delay issue.
# https://stackoverflow.com/questions/12312178/tmux-and-vim-escape-key-being-seen-as-and-having-long-delay#13843382
set -s escape-time 0

# border color
set -g pane-border-style fg=default
set -g pane-active-border-style fg=magenta

# }}}
# Keybinds {{{
#--------------

# unbind default leader
unbind C-b

# keep hitting it by accident
# opens a new window
unbind c

set -g mouse on

# use backtick as leader
set -g prefix `
bind-key ` send-prefix

# in case backtick is needed, double tap backtick 
bind-key C-a set-option -g prefix C-a
bind-key C-b set-option -g prefix `

# setup copy-mode
# bind Escape   copy-mode
# bind / copy-mode
bind Space copy-mode
bind p paste-buffer

# start copy-mode and move up
bind Pageup copy-mode -u #-e

# bind C-u copy-mode -u
# bind -n S-up copy-mode -u -e

# bind -t vi-copy 'v' begin-selection
# bind -t vi-copy 'y' copy-selection
bind-key -Tcopy-mode-vi 'v' send -X begin-selection
bind-key -Tcopy-mode-vi 'y' send -X copy-selection
# these cause issue with tmux-copycat plugin an
# bind -t vi-copy 'Space' halfpage-down
# bind -t vi-copy 'Bspace' halfpage-up

bind-key d detach

#bind-key 0 run "tmux split-window -l 12 'bash -ci ftpane'"

bind q kill-pane

bind > swap-pane -U
bind < swap-pane -D

bind } next-layout
bind { previous-layout
bind = select-layout even-horizontal
bind + select-layout even-vertical

# split panes, but don't docus
bind x split-window -vd
bind v split-window -hd
bind - split-window -vd
bind / split-window -hd

unbind '"'
unbind %

bind : command-prompt

## moving between panes with vim movement keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

## resize panes
bind -n M-C-h resize-pane -L 10
bind -n M-C-j resize-pane -D 10
bind -n M-C-k resize-pane -U 10
bind -n M-C-l resize-pane -R 10

## window handling
bind t new-window
bind [ prev
bind ] next

# mirror browser tab behaviour
bind -n C-Pageup prev
bind -n C-Pagedown next
# bind -n C-S-Pageup swap-window -t -1
# bind -n C-S-Pagedown swap-window -t +1

#}}}
# Status {{{
#----------------

set -g status-position top
# set -g message-attr bold
set -g message-fg brightwhite
set -g message-bg brightblack

set -g status-justify left
set -g status-bg brightblack
set -g status-fg white
set -g status-interval 5

# setw -g window-status-current-fg red
# setw -g window-status-current-attr none
# setw -g window-status-format '#[fg=white]#I-#W#F'
# setw -g window-status-current-format '#[fg=yellow] #I-#W#F '

setw -g window-status-format '#[fg=brightwhite] #I:#W '
setw -g window-status-current-format '#[fg=yellow bold] #I:#W '
setw -g window-status-bell-style fg=black,bg=colour166 
setw -g window-status-separator ''

# set -g status-left '#[fg=magenta] #S#[fg=white]:#P #[fg=cyan] #H #[fg=white] > #T'
# set -g status-left '#[fg=magenta] #S#[fg=white]:#P #[fg=white] > #T'
set -g status-left '#[bg=white fg=black,bold] #S#[fg=black,nobold]:#P '
# set -g status-left-length 120
# set -g status-left-fg black

# set -g status-right '#[fg=cyan]| #[fg=white]#(cat /proc/loadavg | cut -d\  -f-3) #[fg=cyan]| #[fg=blue,bold] %H:%M '
# set -g status-right '#[fg=cyan]| #[fg=white]#(cat /proc/loadavg | cut -d\  -f-3)'
set -g status-right '#[fg=brightwhite] #(< /proc/loadavg cut -d\  -f-3) '
# set -g status-right '#[fg=brightwhite] #(. ~/utils/loadavg-spark.sh)'

# }}}
# Plugins {{{
# -----------

# # Smart pane switching with awareness of vim splits
# # See: https://github.com/christoomey/vim-tmux-navigator
# The idea is to use C-h/j/k/l work with either tmux panes or vim splits.
# Use various methods to identify running commands and either switch pane or pass shortcut through with 'tmux send-keys'
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)n?vim(diff)?$|emacs.*$' && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)n?vim(diff)?$|emacs.*$' || pgrep fzf 2>&1 >/dev/null && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)n?vim(diff)?$|emacs.*$' || pgrep fzf 2>&1 >/dev/null && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)n?vim(diff)?$|emacs.*$' && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-u run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)n?vim(diff|pager)?$|emacs(client)?$|man?$|git?$|bash?$|mutt?$|journalctl?$|ncmpcpp?$' && tmux send-keys C-u) || tmux copy-mode -u"
bind -n C-t run "(pgrep fzf 2>&1 >/dev/null && tmux send-keys C-t) || tmux new-window"

# have C-j,C-k, and C-t work in fzf
# bind -n C-j run "(pgrep fzf 2>&1 >/dev/null && tmux send-keys C-j) || tmux select-pane -D"
# bind -n C-k run "(pgrep fzf 2>&1 >/dev/null && tmux send-keys C-k) || tmux select-pane -U"

## Tmux prefix highlight
## https://github.com/tmux-plugins/tmux-prefix-highlight
# set -g @prefix_highlight_fg 'black'
# set -g @prefix_highlight_bg 'blue'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-copycat'
# set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# }}}
# vim:ft=tmux:ts=2:sw=2:fdm=marker
